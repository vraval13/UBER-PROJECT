(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[620],{290:(e,t,s)=>{Promise.resolve().then(s.bind(s,7770))},3263:(e,t,s)=>{"use strict";s.d(t,{L:()=>d});var a=s(2115),i=s(1478);let r="undefined"!=typeof window?a.useLayoutEffect:a.useEffect,l=e=>e&&!Array.isArray(e)&&"object"==typeof e,n=[],c={},o=i.Ay,d=(e,t=n)=>{let s=c;l(e)?(s=e,e=null,t="dependencies"in s?s.dependencies:n):l(t)&&(t="dependencies"in(s=t)?s.dependencies:n),e&&"function"!=typeof e&&console.warn("First parameter must be a function or config object");let{scope:i,revertOnUpdate:d}=s,u=(0,a.useRef)(!1),m=(0,a.useRef)(o.context(()=>{},i)),x=(0,a.useRef)(e=>m.current.add(null,e)),p=t&&t.length&&!d;return r(()=>{if(e&&m.current.add(e,i),!p||!u.current)return()=>m.current.revert()},t),p&&r(()=>(u.current=!0,()=>m.current.revert()),n),{context:m.current,contextSafe:x.current}};d.register=e=>{o=e},d.headless=!0},5192:(e,t,s)=>{"use strict";var a=s(859);function i(){}function r(){}r.resetWarningCache=i,e.exports=function(){function e(e,t,s,i,r,l){if(l!==a){var n=Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw n.name="Invariant Violation",n}}function t(){return e}e.isRequired=e;var s={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:r,resetWarningCache:i};return s.PropTypes=s,s}},1996:(e,t,s)=>{e.exports=s(5192)()},859:e=>{"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},1762:(e,t,s)=>{"use strict";s.d(t,{A:()=>o});var a=s(5155),i=s(2115),r=s(9047),l=s(2818);let n={width:"100%",height:"100%"},c={lat:-3.745,lng:-38.523},o=()=>{let[e,t]=(0,i.useState)(c);return(0,i.useEffect)(()=>{navigator.geolocation.getCurrentPosition(e=>{let{latitude:s,longitude:a}=e.coords;t({lat:s,lng:a})});let e=navigator.geolocation.watchPosition(e=>{let{latitude:s,longitude:a}=e.coords;t({lat:s,lng:a})});return()=>navigator.geolocation.clearWatch(e)},[]),(0,i.useEffect)(()=>{let e=()=>{navigator.geolocation.getCurrentPosition(e=>{let{latitude:s,longitude:a}=e.coords;console.log("Position updated:",s,a),t({lat:s,lng:a})})};e();let s=setInterval(e,1e3);return()=>clearInterval(s)},[]),(0,a.jsx)(r.aJ,{googleMapsApiKey:l.env.GOOGLE_MAPS_API,children:(0,a.jsx)(r.u6,{mapContainerStyle:n,center:e,zoom:15,children:(0,a.jsx)(r.pH,{position:e})})})}},2801:(e,t,s)=>{"use strict";s.d(t,{default:()=>n});var a=s(5155),i=s(2115),r=s(6046),l=s(5177);let n=e=>{let{children:t}=e,s=localStorage.getItem("token"),n=(0,r.useRouter)(),{user:c,setUser:o}=(0,i.useContext)(l.l),[d,u]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{if(!s){n.push("/UserLogin");return}(async()=>{try{let e=await fetch("".concat("https://uber-backend-zq0d.onrender.com","/users/profile"),{method:"GET",headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/json"}});if(e.ok){let t=await e.json();console.log("user data fetched: ",t),o(t)}else throw Error("Failed to fetch user profile")}catch(e){console.error(e),localStorage.removeItem("token"),n.push("/UserLogin")}finally{u(!1)}})()},[s,n,o]),d)?(0,a.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,a.jsx)("div",{children:"Loading..."})}):(0,a.jsx)(a.Fragment,{children:t})}},1807:(e,t,s)=>{"use strict";s.d(t,{d:()=>l,default:()=>c});var a=s(5155),i=s(2115),r=s(1319);let l=(0,i.createContext)(),n=(0,r.io)("".concat("https://uber-backend-zq0d.onrender.com")),c=e=>{let{children:t}=e;return(0,i.useEffect)(()=>{n.on("connect",()=>{console.log("Connected to server")}),n.on("disconnect",()=>{console.log("Disconnected from server")})},[]),(0,a.jsx)(l.Provider,{value:{socket:n},children:t})}},5177:(e,t,s)=>{"use strict";s.d(t,{default:()=>l,l:()=>r});var a=s(5155),i=s(2115);let r=(0,i.createContext)(),l=e=>{let{children:t}=e,[s,l]=(0,i.useState)({email:"",fullName:{firstName:"",lastName:""}});return(0,a.jsx)("div",{children:(0,a.jsx)(r.Provider,{value:{user:s,setUser:l},children:t})})}},7770:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>N});var a=s(5155),i=s(2801),r=s(2115),l=s(1996),n=s.n(l);let c=e=>{let{suggestions:t=[],setVehiclePanel:s,setPanelOpen:i,setPickup:r,setDestination:l,activeField:n}=e,c=e=>{"pickup"===n?r(e):"destination"===n&&l(e)};return(0,a.jsx)("div",{children:(null==t?void 0:t.length)>0?t.map((e,t)=>(0,a.jsxs)("div",{onClick:()=>c(e),className:"flex gap-4 border-2 p-3 border-gray-50 active:border-black rounded-xl items-center my-2 justify-start cursor-pointer hover:bg-gray-100",children:[(0,a.jsx)("h2",{className:"bg-[#eee] h-8 flex items-center justify-center w-12 rounded-full",children:(0,a.jsx)("i",{className:"ri-map-pin-fill"})}),(0,a.jsx)("h4",{className:"font-medium",children:e})]},t)):(0,a.jsx)("p",{className:"text-gray-500 text-center py-4",children:"No suggestions available"})})};c.propTypes={suggestions:n().array,setVehiclePanel:n().func.isRequired,setPanelOpen:n().func.isRequired,setPickup:n().func.isRequired,setDestination:n().func.isRequired,activeField:n().string.isRequired};var o=s(5565),d=s(3263),u=s(1478);s(2069);let m=e=>{let{createRide:t,setVehiclePanel:s,setConfirmRidePanel:i,selectVehicle:r,fare:l}=e,n=[{name:"UberGo",seats:4,time:"2 mins away",description:"Affordable, compact rides",price:l.car,image:"/car.webp",type:"car"},{name:"Moto",seats:1,time:"3 mins away",description:"Affordable motorcycle rides",price:l.moto,image:"/bike.webp",type:"moto"},{name:"UberAuto",seats:3,time:"3 mins away",description:"Affordable Auto rides",price:l.auto,image:"/auto.webp",type:"auto"}];return(0,a.jsxs)("div",{className:"relative bg-white rounded-t-3xl shadow-lg",children:[(0,a.jsx)("h5",{className:"absolute -top-10 left-1/2 transform -translate-x-1/2 text-gray-200 cursor-pointer",onClick:()=>s(!1),children:(0,a.jsx)("i",{className:"text-3xl ri-arrow-down-wide-line"})}),(0,a.jsx)("h3",{className:"text-2xl font-semibold mb-5 text-center",children:"Choose a Vehicle"}),n.map((e,t)=>(0,a.jsxs)("div",{className:"flex border-2 hover:border-black mb-2 rounded-xl w-full p-3 items-center justify-between cursor-pointer transition-all",onClick:()=>{i(!0),r(e.type)},children:[(0,a.jsx)(o.default,{className:"h-12",src:e.image,alt:e.name,width:64,height:64}),(0,a.jsxs)("div",{className:"ml-2 w-1/2",children:[(0,a.jsxs)("h4",{className:"text-base font-medium",children:[e.name," ",(0,a.jsxs)("span",{className:"text-gray-500",children:[(0,a.jsx)("i",{className:"ri-user-3-fill"})," ",e.seats]})]}),(0,a.jsx)("h5",{className:"text-sm font-medium",children:e.time}),(0,a.jsx)("p",{className:"text-xs text-gray-600",children:e.description})]}),(0,a.jsxs)("h2",{className:"text-lg font-semibold",children:["₹",e.price]})]},t))]})},x=e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"p-1 text-center w-[93%] absolute top-0 ",onClick:()=>{e.setConfirmRidePanel(!1)},children:(0,a.jsx)("i",{className:" text-3xl text-gray-200 ri-arrow-down-wide-line"})}),(0,a.jsx)("h3",{className:"text-2xl font-semibold mb-5",children:"Confirm your Ride"}),(0,a.jsxs)("div",{className:"flex gap-2 justify-between  flex-col items-center",children:[(0,a.jsx)(o.default,{src:{car:"/car.webp",moto:"/bike.webp",auto:"/auto.webp"}[e.vehicleType],alt:"",width:150,height:150}),(0,a.jsxs)("div",{className:"w-full mt-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-5 p-3 border-b-2",children:[(0,a.jsx)("i",{className:" text-lg ri-map-pin-user-fill"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium ",children:e.pickup}),(0,a.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Pickup Location"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-5 p-3 border-b-2",children:[(0,a.jsx)("i",{className:" text-lg ri-map-pin-2-fill"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium ",children:e.destination}),(0,a.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Dropoff Location"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-5 p-3 ",children:[(0,a.jsx)("i",{className:"ri-currency-line"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-medium ",children:["₹",e.fare[e.vehicleType]]}),(0,a.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Cash Cash"})]})]})]}),(0,a.jsx)("button",{onClick:()=>{e.setVehicleFound(!0),e.setConfirmRidePanel(!1),e.createRide()},className:" mt-5 w-full bg-green-600 text-white font-semibold p-2 rounded-lg",children:"Confirm"})]})]}),p=e=>(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"p-1 text-center w-[93%] absolute top-0",onClick:()=>{e.setVehicleFound(!1)},children:(0,a.jsx)("i",{className:"text-3xl text-gray-200 ri-arrow-down-wide-line"})}),(0,a.jsx)("h3",{className:"text-2xl font-semibold mb-5",children:"Looking for a Driver"}),(0,a.jsxs)("div",{className:"flex gap-2 justify-between flex-col items-center",children:[(0,a.jsx)(o.default,{src:{car:"/car.webp",moto:"/bike.webp",auto:"/auto.webp"}[e.vehicleType]||"/car.webp",alt:"",width:150,height:150}),(0,a.jsxs)("div",{className:"w-full mt-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-5 p-3 border-b-2",children:[(0,a.jsx)("i",{className:"text-lg ri-map-pin-user-fill"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:e.pickup}),(0,a.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Pickup Location"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-5 p-3 border-b-2",children:[(0,a.jsx)("i",{className:"text-lg ri-map-pin-2-fill"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:e.destination}),(0,a.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Dropoff Location"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-5 p-3",children:[(0,a.jsx)("i",{className:"ri-currency-line"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-medium",children:["₹",e.fare[e.vehicleType]||"0.00"]}),(0,a.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Cash"})]})]})]})]})]}),h=e=>{var t,s,i,r,l,n;let{setWaitingForDriver:c,ride:d}=e;return(0,a.jsxs)("div",{children:[(0,a.jsx)("h5",{className:"p-1 text-center w-[93%] absolute top-0",onClick:()=>{c(!1)},children:(0,a.jsx)("i",{className:"text-3xl text-gray-200 ri-arrow-down-wide-line"})}),d?(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)(o.default,{src:"/car.webp",width:120,height:120,alt:"Car"}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("h2",{className:"text-lg font-medium capitalize",children:(null===(s=d.captain)||void 0===s?void 0:null===(t=s.fullname)||void 0===t?void 0:t.firstname)+" "+(null==d?void 0:null===(r=d.captain)||void 0===r?void 0:null===(i=r.fullname)||void 0===i?void 0:i.lastname)||"Driver Name"}),(0,a.jsx)("h4",{className:"text-xl font-semibold -mt-1 -mb-1",children:(null===(n=d.captain)||void 0===n?void 0:null===(l=n.vehicle)||void 0===l?void 0:l.plate)||"Plate Number"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:"White Honda Mobilio - V"}),(0,a.jsxs)("h1",{className:"text-lg font-semibold",children:["OTP: ",null==d?void 0:d.otp]})]})]}),(0,a.jsx)("div",{className:"flex gap-2 justify-between flex-col items-center",children:(0,a.jsxs)("div",{className:"w-full mt-5",children:[(0,a.jsxs)("div",{className:"flex items-center gap-5 p-3 border-b-2",children:[(0,a.jsx)("i",{className:"text-lg ri-map-pin-user-fill"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:d.pickup}),(0,a.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Pickup Location"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-5 p-3 border-b-2",children:[(0,a.jsx)("i",{className:"text-lg ri-map-pin-2-fill"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:d.destination}),(0,a.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Dropoff Location"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-5 p-3",children:[(0,a.jsx)("i",{className:"ri-currency-line"}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h3",{className:"text-lg font-medium",children:["₹",d.fare||0]}),(0,a.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Cash Cash"})]})]})]})})]}):(0,a.jsx)("p",{className:"text-center text-gray-500",children:"Loading ride details..."})]})};var f=s(1807),g=s(5177),j=s(8173),v=s.n(j),y=s(6046),b=s(1762);let N=()=>{let e=(0,y.useRouter)(),[t,s]=(0,r.useState)(""),[l,n]=(0,r.useState)(""),[j,N]=(0,r.useState)([]),[w,k]=(0,r.useState)([]),[C,S]=(0,r.useState)(!1),[P,R]=(0,r.useState)(!1),[A,T]=(0,r.useState)(!1),[E,I]=(0,r.useState)(!1),[L,_]=(0,r.useState)(!1),[O,z]=(0,r.useState)({}),[F,D]=(0,r.useState)(null),[q,V]=(0,r.useState)(null),[U,Y]=(0,r.useState)(null),B=(0,r.useRef)(null),W=(0,r.useRef)(null),G=(0,r.useRef)(null),M=(0,r.useRef)(null),H=(0,r.useRef)(null),J=(0,r.useRef)(null),{socket:K}=(0,r.useContext)(f.d),{user:Q}=(0,r.useContext)(g.l);(0,r.useEffect)(()=>(Q&&Q._id&&K.emit("join",{userId:Q._id,userType:"user"}),K.on("ride-confirmed",e=>{I(!1),_(!0),Y(e)}),K.on("ride-started",t=>{_(!1),Y(t),e.replace("/Riding?rideId=".concat(t._id,"&pickup=").concat(t.pickup,"&destination=").concat(t.destination,"&fare=").concat(t.fare,"&captainName=").concat(t.captain.fullname.firstname))}),()=>{K.off("ride-confirmed"),K.off("ride-started")}),[K,Q,e]);let X=async e=>{let t=e.target.value;s(t),localStorage.setItem("pickup",t);try{let t=await fetch("".concat("https://uber-backend-zq0d.onrender.com","/maps/get-suggestions?input=").concat(e.target.value),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),s=await t.json();N(s)}catch(e){console.error("Error fetching pickup suggestions:",e)}},Z=async e=>{let t=e.target.value;n(t),localStorage.setItem("destination",t);try{let t=await fetch("".concat("https://uber-backend-zq0d.onrender.com","/maps/get-suggestions?input=").concat(e.target.value),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}),s=await t.json();k(s)}catch(e){console.error("Error fetching destination suggestions:",e)}};async function $(){try{R(!0),S(!1);let e=localStorage.getItem("pickup")||"",t=localStorage.getItem("destination")||"";console.log("pickup:",e),console.log("destination:",t);let s=await fetch("".concat("https://uber-backend-zq0d.onrender.com","/rides/get-fare?pickup=").concat(encodeURIComponent(e),"&destination=").concat(encodeURIComponent(t)),{method:"GET",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}});if(!s.ok)throw Error("API call failed: ".concat(s.statusText));let a=await s.json();z(a)}catch(e){console.error("Error fetching fare:",e.message)}}async function ee(){try{let e=await fetch("".concat("https://uber-backend-zq0d.onrender.com","/rides/create"),{method:"POST",headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},body:JSON.stringify({pickup:localStorage.getItem("pickup"),destination:localStorage.getItem("destination"),vehicleType:q})});if(!e.ok)throw Error("API call failed: ".concat(e.statusText));let t=await e.json();console.log("Ride created successfully:",t)}catch(e){console.error("Error creating ride:",e.message)}}return(0,d.L)(()=>{u.Ay.to(B.current,{height:C?"70%":"0%",padding:C?24:0,duration:.5}),u.Ay.to(M.current,{opacity:C?1:0,duration:.3})},[C]),(0,d.L)(()=>{u.Ay.to(W.current,{transform:P?"translateY(0)":"translateY(100%)",duration:.5})},[P]),(0,d.L)(()=>{u.Ay.to(G.current,{transform:A?"translateY(0)":"translateY(100%)",duration:.5})},[A]),(0,d.L)(()=>{u.Ay.to(H.current,{transform:E?"translateY(0)":"translateY(100%)",duration:.5})},[E]),(0,d.L)(()=>{u.Ay.to(J.current,{transform:L?"translateY(0)":"translateY(100%)",duration:.5})},[L]),(0,a.jsx)(i.default,{children:(0,a.jsxs)("div",{className:"h-screen relative overflow-hidden",children:[(0,a.jsxs)("div",{className:"fixed p-4 top-0 flex items-center justify-between w-screen",children:[(0,a.jsx)(o.default,{className:"w-16",src:"/logo.png",alt:"Uber Logo",width:64,height:64}),(0,a.jsx)(v(),{href:"/UserLogin",className:"h-10 w-10 bg-white flex items-center justify-center rounded-full",children:(0,a.jsx)("i",{className:"text-lg font-medium ri-logout-box-r-line"})})]}),(0,a.jsx)("div",{className:"h-screen w-screen",children:(0,a.jsx)(b.A,{})}),(0,a.jsxs)("div",{className:"absolute top-0 flex flex-col justify-end h-screen w-full",children:[(0,a.jsxs)("div",{className:"relative bg-white h-[30%] p-6",children:[(0,a.jsx)("h5",{ref:M,onClick:()=>S(!1),className:"absolute right-6 top-6 text-2xl cursor-pointer",children:(0,a.jsx)("i",{className:"ri-arrow-down-wide-line"})}),(0,a.jsx)("h4",{className:"text-2xl font-semibold",children:"Find a trip"}),(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),console.log("Pickup:",t,"Destination:",l)},className:"relative py-3",children:[(0,a.jsx)("input",{onClick:()=>{S(!0),D("pickup")},value:t,onChange:X,className:"bg-[#eee] px-12 py-2 text-lg rounded-lg w-full",type:"text",placeholder:"Add a pick-up location"}),(0,a.jsx)("input",{onClick:()=>{S(!0),D("destination")},value:l,onChange:Z,className:"bg-[#eee] px-12 py-2 text-lg rounded-lg w-full mt-3",type:"text",placeholder:"Enter your destination"})]}),(0,a.jsx)("button",{onClick:$,className:"bg-black text-white px-4 py-2 rounded-lg mt-3 w-full font-semibold",children:"Find trip"})]}),(0,a.jsx)("div",{ref:B,className:"bg-white h-0 overflow-hidden",children:(0,a.jsx)(c,{suggestions:"pickup"===F?j:w,setPanelOpen:S,setVehiclePanel:R,setPickup:s,setDestination:n,activeField:F})})]}),(0,a.jsx)("div",{ref:W,className:"fixed w-full z-10 bottom-0 translate-y-full bg-white px-3 py-10 pt-12",children:(0,a.jsx)(m,{selectVehicle:V,fare:O,setConfirmRidePanel:T,setVehiclePanel:R})}),(0,a.jsx)("div",{ref:G,className:"fixed w-full z-10 bottom-0 translate-y-full bg-white px-3 py-6 pt-12",children:(0,a.jsx)(x,{pickup:t,destination:l,fare:O,vehicleType:q,createRide:ee,setConfirmRidePanel:T,setVehicleFound:I})}),(0,a.jsx)("div",{ref:H,className:"fixed w-full z-10 bottom-0 translate-y-full bg-white px-3 py-6 pt-12",children:(0,a.jsx)(p,{pickup:t,destination:l,fare:O,vehicleType:q,createRide:ee,setVehicleFound:I})}),(0,a.jsx)("div",{ref:J,className:"fixed w-full z-10 bottom-0 translate-y-full bg-white px-3 py-6 pt-12",children:(0,a.jsx)(h,{ride:U,setVehicleFound:I,waitingForDriver:L,setWaitingForDriver:_})})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[703,84,592,970,173,868,716,441,517,358],()=>t(290)),_N_E=e.O()}]);