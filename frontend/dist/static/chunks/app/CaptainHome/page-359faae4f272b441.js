(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[374],{9366:(e,t,s)=>{Promise.resolve().then(s.bind(s,4086))},3263:(e,t,s)=>{"use strict";s.d(t,{L:()=>d});var l=s(2115),i=s(1478);let n="undefined"!=typeof window?l.useLayoutEffect:l.useEffect,a=e=>e&&!Array.isArray(e)&&"object"==typeof e,r=[],o={},c=i.Ay,d=(e,t=r)=>{let s=o;a(e)?(s=e,e=null,t="dependencies"in s?s.dependencies:r):a(t)&&(t="dependencies"in(s=t)?s.dependencies:r),e&&"function"!=typeof e&&console.warn("First parameter must be a function or config object");let{scope:i,revertOnUpdate:d}=s,m=(0,l.useRef)(!1),u=(0,l.useRef)(c.context(()=>{},i)),x=(0,l.useRef)(e=>u.current.add(null,e)),f=t&&t.length&&!d;return n(()=>{if(e&&u.current.add(e,i),!f||!m.current)return()=>u.current.revert()},t),f&&n(()=>(m.current=!0,()=>u.current.revert()),r),{context:u.current,contextSafe:x.current}};d.register=e=>{c=e},d.headless=!0},4086:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>j});var l=s(5155),i=s(2115),n=s(7786),a=s(8173),r=s.n(a),o=s(5565);s(2069);var c=s(4778);let d=()=>{let{captain:e}=(0,i.useContext)(c.Q);return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsxs)("div",{className:"flex items-center justify-start gap-3 ",children:[(0,l.jsx)(o.default,{className:"h-10 w-10 rounded-full object-cover",src:"/random.jpeg",width:200,height:200}),(0,l.jsx)("h4",{className:"text-lg font-medium capitalize",children:e.fullname.firstname+" "+e.fullname.lastname})]}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h4",{className:"text-xl font-semibold",children:"₹295.20"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Earned"})]})]}),(0,l.jsxs)("div",{className:"flex p-3 mt-6 bg-gray-100 rounded-xl justify-center gap-5 items-start",children:[(0,l.jsxs)("div",{className:"text-center ",children:[(0,l.jsx)("i",{className:"text-3xl mb-2 font-thin ri-timer-2-line"}),(0,l.jsx)("h5",{className:"text-lg font-medium",children:"15.4"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Hours Online"})]}),(0,l.jsxs)("div",{className:"text-center ",children:[(0,l.jsx)("i",{className:"text-3xl mb-2 font-thin ri-star-line"}),(0,l.jsx)("h5",{className:"text-lg font-medium",children:"4.6/5.0"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Ratings achieved"})]}),(0,l.jsxs)("div",{className:"text-center ",children:[(0,l.jsx)("i",{className:"text-3xl mb-2 font-thin ri-road-map-line"}),(0,l.jsx)("h5",{className:"text-lg font-medium",children:"500+"}),(0,l.jsx)("p",{className:"text-sm text-gray-600",children:"Rides done"})]})]})]})},m=e=>{var t,s,i,n,a,r,c,d,m,u,x;let f=(null===(i=e.ride)||void 0===i?void 0:null===(s=i.user)||void 0===s?void 0:null===(t=s.fullname)||void 0===t?void 0:t.firstname)&&(null===(r=e.ride)||void 0===r?void 0:null===(a=r.user)||void 0===a?void 0:null===(n=a.fullname)||void 0===n?void 0:n.lastname)?"".concat(e.ride.user.fullname.firstname," ").concat(e.ride.user.fullname.lastname):null===(d=e.ride)||void 0===d?void 0:null===(c=d.user)||void 0===c?void 0:c.fullname;return(0,l.jsxs)("div",{children:[(0,l.jsx)("h5",{className:"p-1 text-center w-[93%] absolute top-0",onClick:()=>{e.setRidePopUpPanel(!1)},children:(0,l.jsx)("i",{className:"text-3xl text-gray-200 ri-arrow-down-wide-line"})}),(0,l.jsx)("h3",{className:"text-2xl font-semibold mb-5",children:"New Ride Available!"}),(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 bg-yellow-400 rounded-lg mt-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(o.default,{className:"h-12 rounded-full object-cover w-12",src:"/random1.jpeg",alt:"",width:100,height:100}),(0,l.jsx)("h2",{className:"text-lg font-medium",children:f})]}),(0,l.jsx)("h5",{className:"text-lg font-semibold",children:"2.2 KM"})]}),(0,l.jsxs)("div",{className:"flex gap-2 justify-between flex-col items-center",children:[(0,l.jsxs)("div",{className:"w-full mt-5",children:[(0,l.jsxs)("div",{className:"flex items-center gap-5 p-3 border-b-2",children:[(0,l.jsx)("i",{className:"ri-map-pin-user-fill"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-medium",children:null===(m=e.ride)||void 0===m?void 0:m.pickup}),(0,l.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Pickup Location"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-5 p-3 border-b-2",children:[(0,l.jsx)("i",{className:"text-lg ri-map-pin-2-fill"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-medium",children:null===(u=e.ride)||void 0===u?void 0:u.destination}),(0,l.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Dropoff Location"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-5 p-3",children:[(0,l.jsx)("i",{className:"ri-currency-line"}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"text-lg font-medium",children:["₹",null===(x=e.ride)||void 0===x?void 0:x.fare," "]}),(0,l.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Cash Cash"})]})]})]}),(0,l.jsxs)("div",{className:"mt-5 w-full",children:[(0,l.jsx)("button",{onClick:()=>{e.setConfirmRidePopUpPanel(!0),e.setRidePopUpPanel(!1),e.confirmRide()},className:"bg-green-600 w-full text-white font-semibold p-2 px-10 rounded-lg",children:"Accept"}),(0,l.jsx)("button",{onClick:()=>{e.setRidePopUpPanel(!1)},className:"mt-2 w-full bg-gray-300 text-gray-700 font-semibold p-2 px-10 rounded-lg",children:"Ignore"})]})]})]})};var u=s(6046);let x=e=>{var t,s,n,a;let{ride:r,setConfirmRidePopUpPanel:c,setRidePopUpPanel:d}=e,m=(0,u.useRouter)(),[x,f]=(0,i.useState)(""),h=async e=>{if(e.preventDefault(),!x){alert("Please enter the OTP.");return}console.log("OTP Submitted:",x);try{let e="".concat("https://uber-backend-zq0d.onrender.com","/rides/start-ride?rideId=").concat(r._id,"&otp=").concat(x),t=await fetch(e,{method:"GET",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))}});if(t.ok)c(!1),d(!1),m.push("/CaptainRiding?rideId=".concat(r._id,"&pickup=").concat(r.pickup,"&destination=").concat(r.destination,"&fare=").concat(r.fare,"&username=").concat(r.user.fullname.firstname)),console.log("at ConfirmRidePopUp Ride Id:",r._id),console.log("at ConfirmRidePopUp Pickup:",r.pickup),console.log("at ConfirmRidePopUp Pickup:",r.destination);else{let e=await t.json();alert(e.message||"Failed to confirm the ride. Please try again.")}}catch(e){console.error("Error confirming ride:",e),alert("An unexpected error occurred. Please try again.")}};return(0,l.jsxs)("div",{className:"relative p-4 bg-white rounded-lg shadow-md",children:[(0,l.jsx)("h5",{className:"p-1 text-center w-[93%] absolute top-0 cursor-pointer",onClick:()=>{d(!1)},children:(0,l.jsx)("i",{className:"text-3xl text-gray-200 ri-arrow-down-wide-line"})}),(0,l.jsx)("h3",{className:"text-2xl font-semibold mb-5",children:"Confirm this ride to Start"}),(0,l.jsxs)("div",{className:"flex items-center justify-between p-3 border-2 border-yellow-400 rounded-lg mt-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(o.default,{className:"h-12 rounded-full object-cover w-12",src:"/random1.jpeg",width:100,height:100,alt:"User"}),(0,l.jsx)("h2",{className:"text-lg font-medium capitalize",children:(null==r?void 0:null===(s=r.user)||void 0===s?void 0:null===(t=s.fullname)||void 0===t?void 0:t.firstname)+" "+(null==r?void 0:null===(a=r.user)||void 0===a?void 0:null===(n=a.fullname)||void 0===n?void 0:n.lastname)||"User Name"})]}),(0,l.jsx)("h5",{className:"text-lg font-semibold",children:"2.2 KM"})]}),(0,l.jsxs)("div",{className:"flex gap-2 justify-between flex-col items-center",children:[(0,l.jsxs)("div",{className:"w-full mt-5",children:[(0,l.jsxs)("div",{className:"flex items-center gap-5 p-3 border-b-2",children:[(0,l.jsx)("i",{className:"ri-map-pin-user-fill"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-medium",children:null==r?void 0:r.pickup}),(0,l.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Pickup Location"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-5 p-3 border-b-2",children:[(0,l.jsx)("i",{className:"text-lg ri-map-pin-2-fill"}),(0,l.jsxs)("div",{children:[(0,l.jsx)("h3",{className:"text-lg font-medium",children:(null==r?void 0:r.destination)||"Destination"}),(0,l.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Dropoff Location"})]})]}),(0,l.jsxs)("div",{className:"flex items-center gap-5 p-3",children:[(0,l.jsx)("i",{className:"ri-currency-line"}),(0,l.jsxs)("div",{children:[(0,l.jsxs)("h3",{className:"text-lg font-medium",children:["₹",(null==r?void 0:r.fare)||"0.00"]}),(0,l.jsx)("p",{className:"text-sm -mt-1 text-gray-600",children:"Cash"})]})]})]}),(0,l.jsx)("div",{className:"mt-6 w-full",children:(0,l.jsxs)("form",{onSubmit:h,children:[(0,l.jsx)("input",{value:x,onChange:e=>f(e.target.value),type:"text",className:"bg-[#eee] px-6 py-4 font-mono text-lg rounded-lg w-full mt-3",placeholder:"Enter OTP"}),(0,l.jsx)("button",{type:"submit",className:"w-full mt-5 text-lg flex justify-center bg-green-600 text-white font-semibold p-3 rounded-lg",children:"Confirm"}),(0,l.jsx)("button",{type:"button",onClick:()=>{c(!1),d(!1)},className:"w-full mt-2 bg-red-600 text-lg text-white font-semibold p-3 rounded-lg",children:"Cancel"})]})})]})]})};var f=s(3263),h=s(1478),p=s(1807),g=s(1762);let j=()=>{let[e,t]=(0,i.useState)(!1),[s,a]=(0,i.useState)(!1),[u,j]=(0,i.useState)(null),v=(0,i.useRef)(null),N=(0,i.useRef)(null),{socket:b}=(0,i.useContext)(p.d),{captain:y}=(0,i.useContext)(c.Q);async function w(){try{let e=await fetch("".concat("https://uber-backend-zq0d.onrender.com","/rides/confirm"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(localStorage.getItem("token"))},body:JSON.stringify({rideId:u._id,captainId:y._id})});if(console.log("Response:",e),console.log("Ride ID:",u._id),console.log("Captain ID:",y._id),!e.ok){let t=await e.json();throw Error(t.message||"Failed to confirm the ride")}t(!1),a(!0)}catch(e){console.error("Error confirming ride:",e.message)}}return(0,i.useEffect)(()=>{if(y&&y._id){b.emit("join",{userId:y._id,userType:"captain"});let e=()=>{navigator.geolocation&&navigator.geolocation.getCurrentPosition(e=>{console.log({userId:y._id,location:{ltd:e.coords.latitude,lng:e.coords.longitude}}),b.emit("update-location-captain",{userId:y._id,location:{ltd:e.coords.latitude,lng:e.coords.longitude}})})};setInterval(e,1e4),e()}},[b,y]),b.on("new-ride",e=>{console.log(e),j(e),t(!0)}),(0,i.useEffect)(()=>{setTimeout(()=>{j({captainName:"",distance:"",pickup:"",dropoff:"",fare:""}),t(!0)},2e3)},[]),(0,f.L)(()=>{h.Ay.to(v.current,{transform:e?"translateY(0)":"translateY(100%)",duration:.5})},[e]),(0,f.L)(()=>{h.Ay.to(N.current,{transform:s?"translateY(0)":"translateY(100%)",duration:.5})},[s]),(0,l.jsx)(n.default,{children:(0,l.jsxs)("div",{className:"h-screen",children:[(0,l.jsxs)("div",{className:"fixed p-4 top-0 flex items-center justify-between w-screen",children:[(0,l.jsx)(o.default,{className:"w-16",src:"/uber-driver.svg",alt:"Uber Logo",width:64,height:64}),(0,l.jsx)(r(),{href:"/CaptainLogin",className:"h-10 w-10 bg-white flex items-center justify-center rounded-full",children:(0,l.jsx)("i",{className:"text-lg font-medium ri-logout-box-r-line"})})]}),(0,l.jsx)("div",{className:"h-3/5",children:(0,l.jsx)(g.A,{})}),(0,l.jsx)("div",{className:"h-2/5 p-6",children:(0,l.jsx)(d,{})}),(0,l.jsx)("div",{ref:v,className:"fixed w-full z-10 bottom-0 translate-y-full bg-white px-3 py-10 pt-12",children:u&&(0,l.jsx)(m,{setRidePopUpPanel:t,setConfirmRidePopUpPanel:a,ride:u,confirmRide:w})}),(0,l.jsx)("div",{ref:N,className:"fixed w-full z-10 bottom-0 h-screen translate-y-full bg-white px-3 py-10 pt-12",children:(0,l.jsx)(x,{ride:u,setConfirmRidePopUpPanel:a,setRidePopUpPanel:t})})]})})}},7786:(e,t,s)=>{"use strict";s.d(t,{default:()=>o});var l=s(5155),i=s(2115),n=s(6046),a=s(2651),r=s(4778);let o=e=>{let{children:t}=e,s=localStorage.getItem("token"),o=(0,n.useRouter)(),{captain:c,setCaptain:d}=(0,i.useContext)(r.Q),[m,u]=(0,i.useState)(!0);return((0,i.useEffect)(()=>{if(!s){o.push("/CaptainLogin");return}(async()=>{try{let e=await a.A.get("".concat("https://uber-backend-zq0d.onrender.com","/captains/profile"),{headers:{Authorization:"Bearer ".concat(s)}});200===e.status&&(d(e.data.captain),u(!1))}catch(e){console.error("Error validating captain:",e),localStorage.removeItem("token"),o.push("/CaptainLogin")}})()},[s,o,d]),m)?(0,l.jsx)("div",{children:"Loading..."}):(0,l.jsx)(l.Fragment,{children:t})}},1762:(e,t,s)=>{"use strict";s.d(t,{A:()=>c});var l=s(5155),i=s(2115),n=s(9047),a=s(2818);let r={width:"100%",height:"100%"},o={lat:-3.745,lng:-38.523},c=()=>{let[e,t]=(0,i.useState)(o);return(0,i.useEffect)(()=>{navigator.geolocation.getCurrentPosition(e=>{let{latitude:s,longitude:l}=e.coords;t({lat:s,lng:l})});let e=navigator.geolocation.watchPosition(e=>{let{latitude:s,longitude:l}=e.coords;t({lat:s,lng:l})});return()=>navigator.geolocation.clearWatch(e)},[]),(0,i.useEffect)(()=>{let e=()=>{navigator.geolocation.getCurrentPosition(e=>{let{latitude:s,longitude:l}=e.coords;console.log("Position updated:",s,l),t({lat:s,lng:l})})};e();let s=setInterval(e,1e3);return()=>clearInterval(s)},[]),(0,l.jsx)(n.aJ,{googleMapsApiKey:a.env.GOOGLE_MAPS_API,children:(0,l.jsx)(n.u6,{mapContainerStyle:r,center:e,zoom:15,children:(0,l.jsx)(n.pH,{position:e})})})}},4778:(e,t,s)=>{"use strict";s.d(t,{Q:()=>n,default:()=>a});var l=s(5155),i=s(2115);let n=(0,i.createContext)(),a=e=>{let{children:t}=e,[s,a]=(0,i.useState)(null),[r,o]=(0,i.useState)(!1),[c,d]=(0,i.useState)(null);return(0,l.jsx)(n.Provider,{value:{captain:s,setCaptain:a,isLoading:r,setIsLoading:o,error:c,setError:d,updateCaptain:e=>{a(e)}},children:t})}},1807:(e,t,s)=>{"use strict";s.d(t,{d:()=>a,default:()=>o});var l=s(5155),i=s(2115),n=s(1319);let a=(0,i.createContext)(),r=(0,n.io)("".concat("https://uber-backend-zq0d.onrender.com")),o=e=>{let{children:t}=e;return(0,i.useEffect)(()=>{r.on("connect",()=>{console.log("Connected to server")}),r.on("disconnect",()=>{console.log("Disconnected from server")})},[]),(0,l.jsx)(a.Provider,{value:{socket:r},children:t})}}},e=>{var t=t=>e(e.s=t);e.O(0,[703,84,592,970,173,868,716,651,441,517,358],()=>t(9366)),_N_E=e.O()}]);